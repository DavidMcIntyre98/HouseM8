<!DOCTYPE html>
<html lang="en">
<head>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-app.js"></script>
    <meta charset="UTF-8">
    <title>Create Profile</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
  
    <title>HouseM8</title>
  
    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  
    <!-- Custom fonts for this template -->
    <link href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i" rel="stylesheet">
  
    <!-- Custom styles for this template -->
    <link href="css/one-page-wonder.min.css" rel="stylesheet">


    <script src="javascripts/PostData.js"></script>
    <script src="javascripts/getcomments.js"></script>
    
    <script src="javascripts/postcomments.js"></script>
    <script src="javascripts/deletecomment.js"></script>
    <script src="javascripts/image_data.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>


    <script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-storage.js"></script>
    
</head>
<body style="background-image: url('img/background2.png');">
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top">
        <div class="container">
            <a href="index.html">
          <img style="width: 93%;height:93%" alt="HouseM8 Home" src="img/HouseM8.png">
        </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item">
                <a class="nav-link"style="color: white; font-size: medium;" href="/register.html">Sign Up</a>
              </li>
              <li class="nav-item">
                <a class="nav-link"style="color: white; font-size: medium;" href="/login.html">Log In</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <section style="padding-top: 12%;">
        <div>
            <img  style="height:75%;margin-left:7%; position: absolute; border-radius: 15%;" src="img/House4.png">
        </div>
        <table style="margin-left:50%; background-color:rgba(255, 254, 254, 1); border-radius: 25px; padding:20px; width: 30%">
            <div id="filesubmit">
            <thead>
              <tr>
                <th rowspan="8"></th>
                <th>
                    <h1 style="text-align: center; font-size: 350%;margin-top: 6%;">Sign up</h1>
                </th>
              </tr>
              <tr>
                <td >
                    <input id = "name" value=" Full Name *"style="color: rgb(104, 104, 104);border-radius: 12px;margin-bottom:20px;margin-top:25px; margin-left:30%">
                </td>
              </tr>
              <tr>
                <td >
                    <input id = "city" value=" City *"style="color: rgb(104, 104, 104);border-radius: 12px;margin-bottom:20px; margin-left:30%">
                </td>
              </tr>
              <tr>
                <td>
                    <input id = "age" value=" Age *"style="color: rgb(104, 104, 104);border-radius: 12px;margin-bottom:20px; margin-left:30%">
                </td>
              </tr>
              <tr>
                <td >
                    <input id = "studying" value=" Course Name *"style="color: rgb(104, 104, 104); border-radius: 12px; margin-bottom:20px; margin-left:30%">
                </td>
              </tr>
              <tr>
                <td >
                    <input id = "cName" value=" University/College *" style="color: rgb(104, 104, 104); border-radius: 12px;margin-bottom:20px; margin-left:30%">
                </td>
              </tr>
              <tr>
                <td >
                  <div>
                    <label>
                      <h4> Upload Photos </h4>
                    </label>
                    <input type="file" id="t-image">
                    <div class="invalid-feedback">
                      Please choose a valid picture
                    </div>
                  </div>
                  <div>
                    <img id="selected-image" width="250" height="150" src="#" />
                  </div>
                  <div>
                    <div class="progress bg-secondary">
                      <div class="progress-bar bg-success" id="upload-progress" style="width: 0%;">0%</div>
    
                    </div>
                  </div>
                  <div>
                    <button id="save-images" type="button" style="width:150px; height:60px;"
                  class="btn btn-light bg-light text-dark">Upload Images to Database </button>
                  </div>

                </td>
              </tr>
              <tr>
                <td>
                    <p id = "putCookie" style=" margin-left:25%">cookie goes here</p>
                    <button onclick="PostData()" class="btn btn-primary" style="width: 50%;  margin-left:22%; margin-bottom: 6%;">Submit</button>
                </td>
              </tr>
            </thead>
            </div>
        
            </table>    

    </section>
    <p style="padding-bottom: 10%;"></p>
      <section  style="background-color:rgb(250,82,29); height:30%;">
        <div class="container">
          
          <div class="row align-items-center">
            <div class="col-lg-6 order-lg-2">
              <style type="text/css">
                .tg  {border-collapse:collapse;border-spacing:0;width:25%;height:25%}
                .tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
                  overflow:hidden;padding:10px 5px;word-break:normal;}
                .tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
                  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
                .tg .tg-0pky{border-color:inherit;text-align:center;vertical-align:top;width:25%;height:25%}
                </style>
                
              <div class="p-5" style="text-align: center;">
               <a href="/register.html" class="btn btn-primary btn-xl rounded-pill mt-6">Sign Up</a>
              </div>
            </div>
            <div class="col-lg-6 order-lg-1">
              <div class="p-5">
                <h2 class="display-4" style="text-align: center">Find your dream HouseM8's!</h2>
              </div>
            </div>
          </div>
        </div>
        
      </section>


      <!---------------------Validation and Uploading of Images------------------------------->
    <script>

      $("#selected-image").hide();

      function previewImage(image_t) {
        var reader = new FileReader();

        reader.onload = function (e) {
          $("#selected-image").attr('src', e.target.result);
          $("#selected-image").fadeIn();
        }
        reader.readAsDataURL(image_t.files[0]);



      }

      $("#t-image").change(function () {
        previewImage(this);
      });

      $("#save-images").click(function () {
        var validImagetypes = ["image/gif", "image/jpeg", "image/png"];

        $("#t-image").removeClass("is-invalid");

        var pic_t = $("#t-image").prop("files")[0];


        if (pic_t == null) {
          $("#t-image").addClass("is-invalid");
          return;
        }

        /*if ($.inArray(pic_t["type"], validImagetypes) > 0) {
          $("#t-image").addClass("is-invalid");
          return;
        }*/
        if ($.inArray(pic_t["type"], validImagetypes) < 0) {
          $("#t-image").addClass("is-invalid");
          return;
        }

        //*****************************************Upload and Save to Firebase Storage**************************

        var databaseRef = firebase.database().ref("Images");
        console.log("try and upload this");
        databaseRef.once("value").then(function (snapshot) {
          var name = pic_t["name"];
          var dateStr = new Date().getTime();
          var fileCompleteName = name + "_" + dateStr;
          console.log("upload image: " + fileCompleteName);
          var storageRef = firebase.storage().ref("Tenant Images");
          var tStorageRef = storageRef.child(fileCompleteName);
          //var imageRef = firebase.firestore().ref("Image Data");
          console.log(JSON.stringify(pic_t));

          var uploadTask = tStorageRef.put(pic_t);

          uploadTask.on("state_changed",

            function progress(snapshot) {
              var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
              $("#upload-progress").html(Math.round(percentage) + "%");
              $("#upload-progress").attr("style", "width:" + percentage + "%");

            },

            function error(err) {


            },



            function complete() {
              var user = firebase.auth().currentUser;
              if (user) {
                firebase.database().ref('Users/' + user.uid).once('value').then(function () {
                  var location = (snapshot.val() && snapshot.val().location);


                });
              }
              uploadTask.snapshot.ref.getDownloadURL().then(function (downloadUrl) {

                var time = new Date();
                var options =
                {
                  weekday: "long",
                  month: "long",
                  day: "2-digit",
                  year: "numeric"
                };

                var imageData =
                {
                  "image": downloadUrl,
                  "name": fileCompleteName,
                  "uid": user.uid,
                  "time": time.toLocaleString('en-gb', { hour: 'numeric', minute: 'numeric', hour12: true }),
                  "date": time.toLocaleDateString('en-gb', options),
                };
                var newPostRef = databaseRef.push();

              //  var newImageRef = imageRef.push();

                newPostRef.set(imageData, function (err) {

                  if (err) {
                    $("#result").attr("class", "alert alert-danger");
                    $("#result").html(err.message);

                  }
                  else {
                    $("#result").attr("class", "alert alert-success");
                    $("#result").html("Image has been uploaded successfully.");

                    window.open("", "_self");

                  }
                });

                /*newImageRef.set(imageData, function (err) {

                  if (err) {
                    $("#result").attr("class", "alert alert-danger");
                    $("#result").html(err.message);

                  }
                  else {
                    $("#result").attr("class", "alert alert-success");
                    $("#result").html("Image has been uploaded successfully.");

                    window.open("", "_self");

                  }
                }); 

                var firestoreRef = firebase.collection("Images");

                firestoreRef.collection("imageData").doc().set(imageData).then(() => {
                  console.log("Doc successfully uploaded");
                });*/

                var imgLink = downloadUrl;
                document.getElementById("myLink").value = imgLink;


                // var imageFirestoreData = [];

                // imageFirestoreData.push({name:fileCompleteName, uid:user.uid, pic_URL: downloadUrl});

                postImage();


              });

            }

          );



        }

        );




        //*****************************************Upload and Save to Firebase Storage**************************

      });

      function resetForm() {
        $("#t-image").fadeOut();
        $("#upload-progress").html("Completed");
      };
    </script>

    <p id="myLink"> </p>


    <!---------------------Validation and Uploading of Images Ends Here------------------------------->







      <!-- Footer -->
      <footer class="py-5 bg-black">
        <div class="container">
          <p class="m-0 text-center text-white small">Copyright &copy; AltF4 LTD</p>
        </div>
        <!-- /.container -->
      </footer>

 
  

  <!-- TODO: Add SDKs for Firebase products that you want to use
  https://firebase.google.com/docs/web/setup#available-libraries -->

  <!-- Initialize Firebase -->
  <script src="/__/firebase/init.js"></script>

    
    
    
    
</body>
</html>